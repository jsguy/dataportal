<html>
<head>
	<title>Dataportal object example</title>
	<script type="text/javascript" src="node_modules/jsondiffpatch/public/build/jsondiffpatch.js"></script>
	<script type="text/javascript" src="js/sockjs-1.0.3.js"></script>
	<script type="text/javascript" src="js/jquery-1.11.3.js"></script>
	<script type="text/javascript" src="js/hash.js"></script>
    <!-- Set the url parameter to the IP address or URL of your server -->
	<script src="js/dataportal.js?url=http://local.mac:9999/dataPortal"></script>
	<script src="js/caretpos.js"></script>
	<style>
		textarea {width: 50rem; height: 12rem;}
	</style>
</head>
<body>

<textarea id="json">{"me": {"an": "object"}, "stuff": ["a", 2, "c"]}</textarea>
<hr/>
<button id="publish">Publish changed data</button>

<script>
var obj,
	ta = $("#json").get(0),
	//	Grab or set the value from the textarea
	syncValue = function(value){
		if(value) {
			obj = value;
			$('#json').val(JSON.stringify(obj));
		} else {
			obj = JSON.parse($('#json').val());
		}
	},
	mp;

syncValue();

//	Create a portal for this topic
mp = dataPortal(obj, "objtopic", {
	onready: function(portal){
		//	Subscribe to and update our object
		portal.subscribe(function(value){
			syncValue(value);
		});

		//	Modify our object and publish it
		obj.c = {"f":"minor_" + (new Date()).getTime()};
		portal.publish(obj);
	}, 
	onclose: function(){
		//	Reload if we lose the connection
		setTimeout(function(){
			document.location.reload();
		}, 2500);
	}
});

$('#publish').click(function(){
	syncValue();
	mp.publish(obj);
});
</script>


</body>
</html>